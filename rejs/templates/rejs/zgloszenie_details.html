{% extends "rejs/base.html" %}

{% block title %}Szczegóły zgłoszenia - {{ zgloszenie.rejs.nazwa }} - Zobaczyć Morze{% endblock %}

{% block nav %}
<a href="{% url 'index' %}">&larr; Powrót do listy rejsów</a>
{% endblock %}

{% block content %}
<h1>Szczegóły Twojego zgłoszenia</h1>

<!-- Baner statusu -->
<div class="status-banner status-{{ zgloszenie.status|lower }}"
     role="status"
     aria-label="Status zgłoszenia">
    <strong>Status:</strong> {{ zgloszenie.get_status_display }}
</div>

<!-- Sekcja: Dane osobowe -->
<section class="content-section" aria-labelledby="section-personal">
    <h2 id="section-personal">Dane osobowe</h2>
    <dl class="details-list">
        <div class="detail-row">
            <dt>Imię:</dt>
            <dd>{{ zgloszenie.imie }}</dd>
        </div>
        <div class="detail-row">
            <dt>Nazwisko:</dt>
            <dd>{{ zgloszenie.nazwisko }}</dd>
        </div>
        <div class="detail-row">
            <dt>E-mail:</dt>
            <dd>{{ zgloszenie.email }}</dd>
        </div>
        <div class="detail-row">
            <dt>Telefon:</dt>
            <dd>{{ zgloszenie.telefon }}</dd>
        </div>
        <div class="detail-row">
            <dt>Data urodzenia:</dt>
            <dd>{{ zgloszenie.data_urodzenia|date:"d.m.Y" }}</dd>
        </div>
        <div class="detail-row">
            <dt>Adres:</dt>
            <dd>{{ zgloszenie.adres }}</dd>
        </div>
        <div class="detail-row">
            <dt>Kod pocztowy:</dt>
            <dd>{{ zgloszenie.kod_pocztowy }}</dd>
        </div>
        <div class="detail-row">
            <dt>Miejscowość:</dt>
            <dd>{{ zgloszenie.miejscowosc }}</dd>
        </div>        
        <div class="detail-row">
            <dt>Status wzroku:</dt>
            <dd>{{ zgloszenie.get_wzrok_display }}</dd>
        </div>
        <div class="detail-row">
            <dt>Status zgłoszenia:</dt>
            <dd>{{ zgloszenie.get_status_display }}</dd>
        </div>
        {% if zgloszenie.dane_dodatkowe %}
        <div class="detail-row">
            <dt>pesel::</dt>
            <dd>{{ zgloszenie.dane_dodatkowe.masked_pesel }}</dd>
        </div>
        <div class="detail-row">
            <dt>dokument:</dt>
            <dd>{{ zgloszenie.dane_dodatkowe.get_poz2_display }} {{ zgloszenie.dane_dodatkowe.masked_dokument }}</dd>
        </div>
    
    {% endif %}
    </dl>
</section>

<!-- Sekcja: Płatności -->
<section class="content-section" aria-labelledby="section-payments">
    <h2 id="section-payments">Płatności</h2>

    <dl class="details-list">
        <div class="detail-row">
            <dt>Cena rejsu:</dt>
            <dd><strong>{{ zgloszenie.rejs_cena }} zł</strong></dd>
        </div>
        <div class="detail-row">
            <dt>Suma wpłat:</dt>
            <dd>{{ zgloszenie.suma_wplat }} zł</dd>
        </div>
        <div class="detail-row {% if zgloszenie.do_zaplaty > 0 %}highlight-warning{% else %}highlight-success{% endif %}">
            <dt>Pozostało do zapłaty:</dt>
            <dd>
                <strong>{{ zgloszenie.do_zaplaty }} zł</strong>
                {% if zgloszenie.do_zaplaty == 0 %}
                <span class="badge badge-success">Opłacono</span>
                {% endif %}
            </dd>
        </div>
        <div>
            {% if zgloszenie.suma_wplat < zgloszenie.rejs.zaliczka %}
<a href="{% url 'zaplac' zgloszenie.token 'zaliczka' %}">
    Opłać zaliczkę
</a>
{% endif %}

{% if zgloszenie.status == 'Zakwalifikowany' and zgloszenie.do_zaplaty > 0 %}
<a href="{% url 'zaplac' zgloszenie.token 'reszta' %}">
    Opłać pozostałą kwotę
</a>
{% endif %}

        </div>
    </dl>
</section>
{% if zgloszenie.wachta %}
<section class="content-section" aria-labelledby="section-watch">
    <h2 id="section-watch">Wachta: {{ zgloszenie.wachta.nazwa }}</h2>

    <dl class="details-list">
        {% for czlonek in zgloszenie.wachta.czlonkowie.all %}
            {% if czlonek.id != zgloszenie.id %}
            <div class="detail-row">
                <dt>{{ czlonek.imie }} {{ czlonek.nazwisko }}:</dt>
                <dd>{{ czlonek.get_rola_display }}</dd>
            </div>
            {% endif %}
        {% endfor %}
    </dl>

    {% if zgloszenie.wachta.czlonkowie.count <= 1 %}
        <p class="no-results">Brak innych członków wachty.</p>
    {% endif %}
</section>
{% endif %}

<!-- Sekcja: Informacje o rejsie -->
<section class="content-section" aria-labelledby="section-cruise">
    <h2 id="section-cruise">Informacje o rejsie</h2>
    <h3>{{ zgloszenie.rejs.nazwa }}</h3>
    <p>
        <strong>Termin:</strong>
        <time datetime="{{ zgloszenie.rejs.od|date:'Y-m-d' }}">{{ zgloszenie.rejs.od|date:'j E Y' }}</time>
        &rarr;
        <time datetime="{{ zgloszenie.rejs.do|date:'Y-m-d' }}">{{ zgloszenie.rejs.do|date:'j E Y' }}</time>
    </p>
    <p><strong>Trasa:</strong> {{ zgloszenie.rejs.start }} &rarr; {{ zgloszenie.rejs.koniec }}</p>
    {% if zgloszenie.rejs.opis %}
    <div class="cruise-description">
        {{ zgloszenie.rejs.opis|linebreaks }}
    </div>
    {% endif %}
</section>

<!-- Sekcja: Ogłoszenia -->
<section class="content-section" aria-labelledby="section-announcements">
    <h2 id="section-announcements">Ogłoszenia rejsowe</h2>

    {% if zgloszenie.rejs.ogloszenia.all %}
    <ol class="announcements-list" role="list">
        {% for o in zgloszenie.rejs.ogloszenia.all %}
        <li class="announcement-item">
            <article>
                <h3>{{ o.tytul }}</h3>
                <div class="announcement-content">
                    {{ o.text|linebreaks }}
                </div>
            </article>
        </li>
        {% endfor %}
    </ol>
    {% else %}
    <p class="no-results">Brak ogłoszeń dla tego rejsu.</p>
    {% endif %}
</section>
{% endblock %}
